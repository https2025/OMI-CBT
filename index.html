<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMI-CBT - Online Madrasah Computer-Based Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #0066cc;
            --secondary-color: #004499;
            --accent-color: #ff9900;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --white: #ffffff;
            --text-color: #333333;
            --border-color: #dee2e6;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 8px 15px rgba(0, 0, 0, 0.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles */
        .header {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 1rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .logo i {
            margin-right: 10px;
            font-size: 2rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-info span {
            margin-right: 15px;
        }
        
        .user-info button {
            background-color: transparent;
            border: 1px solid var(--white);
            color: var(--white);
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .user-info button:hover {
            background-color: var(--white);
            color: var(--primary-color);
        }
        
        /* Login Page */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(rgba(0, 102, 204, 0.8), rgba(0, 102, 204, 0.8)), url('https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1887&q=80') no-repeat center center/cover;
            padding: 20px;
        }
        
        .login-form {
            background-color: var(--white);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: var(--shadow-hover);
            width: 100%;
            max-width: 400px;
            animation: fadeInUp 0.5s ease;
        }
        
        .login-form h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            transition: border 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }
        
        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: var(--white);
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: var(--text-color);
        }
        
        .btn-warning:hover {
            background-color: #e0a800;
        }
        
        .btn-info {
            background-color: var(--info-color);
        }
        
        .btn-info:hover {
            background-color: #138496;
        }
        
        /* Dashboard */
        .dashboard {
            padding: 2rem 0;
        }
        
        .dashboard-header {
            margin-bottom: 2rem;
        }
        
        .dashboard-header h1 {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .dashboard-header p {
            color: #666;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background-color: var(--white);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            font-size: 1.5rem;
            color: var(--white);
        }
        
        .stat-icon.blue {
            background-color: var(--primary-color);
        }
        
        .stat-icon.green {
            background-color: var(--success-color);
        }
        
        .stat-icon.orange {
            background-color: var(--accent-color);
        }
        
        .stat-icon.red {
            background-color: var(--danger-color);
        }
        
        .stat-icon.purple {
            background-color: #6f42c1;
        }
        
        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 0.2rem;
        }
        
        .stat-info p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .content-section {
            background-color: var(--white);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            animation: fadeIn 0.5s ease;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .section-header h2 {
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .search-box {
            position: relative;
            width: 250px;
        }
        
        .search-box input {
            width: 100%;
            padding: 0.5rem 2.5rem 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .search-box i {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th,
        .table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .table th {
            background-color: var(--light-bg);
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .table tr:hover {
            background-color: rgba(0, 102, 204, 0.05);
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .badge-success {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }
        
        .badge-warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
        }
        
        .badge-danger {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }
        
        .badge-info {
            background-color: rgba(23, 162, 184, 0.1);
            color: var(--info-color);
        }
        
        .badge-primary {
            background-color: rgba(0, 102, 204, 0.1);
            color: var(--primary-color);
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }
        
        /* Exam Interface */
        .exam-container {
            max-width: 900px;
            margin: 2rem auto;
            background-color: var(--white);
            border-radius: 10px;
            box-shadow: var(--shadow-hover);
            overflow: hidden;
            animation: fadeIn 0.5s ease;
        }
        
        .exam-header {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .exam-timer {
            display: flex;
            align-items: center;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .exam-timer i {
            margin-right: 0.5rem;
        }
        
        .exam-timer.warning {
            color: var(--warning-color);
        }
        
        .exam-timer.danger {
            color: var(--danger-color);
            animation: pulse 1s infinite;
        }
        
        .exam-content {
            padding: 1.5rem;
        }
        
        .question-container {
            margin-bottom: 2rem;
        }
        
        .question-number {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .question-text {
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        
        .options {
            display: grid;
            gap: 0.75rem;
        }
        
        .option {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .option:hover {
            background-color: rgba(0, 102, 204, 0.05);
            border-color: var(--primary-color);
        }
        
        .option input[type="radio"] {
            margin-right: 0.75rem;
        }
        
        .option.selected {
            background-color: rgba(0, 102, 204, 0.1);
            border-color: var(--primary-color);
        }
        
        .exam-navigation {
            display: flex;
            justify-content: space-between;
            border-top: 1px solid var(--border-color);
            padding-top: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .question-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            justify-content: center;
        }
        
        .question-btn {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border-color);
            background-color: var(--white);
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .question-btn:hover {
            background-color: rgba(0, 102, 204, 0.1);
            border-color: var(--primary-color);
        }
        
        .question-btn.active {
            background-color: var(--primary-color);
            color: var(--white);
            border-color: var(--primary-color);
        }
        
        .question-btn.answered {
            background-color: var(--success-color);
            color: var(--white);
            border-color: var(--success-color);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: var(--white);
            border-radius: 10px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2rem;
            position: relative;
            animation: fadeInDown 0.3s ease;
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            transition: color 0.3s ease;
        }
        
        .modal-close:hover {
            color: var(--danger-color);
        }
        
        .modal-header {
            margin-bottom: 1.5rem;
        }
        
        .modal-header h2 {
            color: var(--primary-color);
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--white);
            border-radius: 5px;
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-hover);
            display: flex;
            align-items: center;
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .toast.success {
            border-left: 4px solid var(--success-color);
        }
        
        .toast.success i {
            color: var(--success-color);
        }
        
        .toast.error {
            border-left: 4px solid var(--danger-color);
        }
        
        .toast.error i {
            color: var(--danger-color);
        }
        
        .toast.warning {
            border-left: 4px solid var(--warning-color);
        }
        
        .toast.warning i {
            color: var(--warning-color);
        }
        
        .toast.info {
            border-left: 4px solid var(--info-color);
        }
        
        .toast.info i {
            color: var(--info-color);
        }
        
        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 1s ease-in-out infinite;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .search-box {
                width: 100%;
            }
            
            .table {
                font-size: 0.9rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .exam-navigation {
                flex-direction: column;
            }
            
            .question-nav {
                justify-content: flex-start;
            }
        }
        
        .hidden {
            display: none !important;
        }
        
        .disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-form">
            <h2><i class="fas fa-graduation-cap"></i> OMI-CBT</h2>
            <p style="text-align: center; margin-bottom: 1.5rem; color: #666;">Online Madrasah Computer-Based Test</p>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Masukkan username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Masukkan password" required>
                </div>
                <div class="form-group">
                    <label for="role">Login Sebagai</label>
                    <select id="role" required>
                        <option value="">Pilih Role</option>
                        <option value="admin">Admin</option>
                        <option value="guru">Guru</option>
                        <option value="siswa">Siswa</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-block">Login</button>
            </form>
            <div style="text-align: center; margin-top: 1rem; font-size: 0.9rem; color: #666;">
                <p>Demo: admin/admin123, guru/guru123, siswa/siswa123</p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-graduation-cap"></i>
                        <span>OMI-CBT</span>
                    </div>
                    <div class="user-info">
                        <span id="welcomeText">Selamat Datang</span>
                        <button id="logoutBtn">Logout</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard -->
        <div class="dashboard">
            <div class="container">
                <div class="dashboard-header">
                    <h1 id="dashboardTitle">Dashboard</h1>
                    <p id="dashboardSubtitle">Selamat datang di sistem OMI-CBT</p>
                </div>

                <!-- Admin Dashboard -->
                <div id="adminDashboard" class="dashboard-content hidden">
                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-icon blue">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalUsers">0</h3>
                                <p>Total Pengguna</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon green">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalQuestions">0</h3>
                                <p>Total Soal</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon orange">
                                <i class="fas fa-clipboard-list"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalExams">0</h3>
                                <p>Total Ujian</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon purple">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="avgScore">0%</h3>
                                <p>Nilai Rata-rata</p>
                            </div>
                        </div>
                    </div>

                    <div class="content-section">
                        <div class="section-header">
                            <h2>Pengguna Terdaftar</h2>
                            <div style="display: flex; gap: 1rem;">
                                <div class="search-box">
                                    <input type="text" id="userSearch" placeholder="Cari pengguna...">
                                    <i class="fas fa-search"></i>
                                </div>
                                <button class="btn" id="addUserBtn"><i class="fas fa-plus"></i> Tambah</button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Username</th>
                                        <th>Nama Lengkap</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="userTableBody">
                                    <!-- User rows will be generated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="content-section">
                        <div class="section-header">
                            <h2>Ujian Aktif</h2>
                            <div style="display: flex; gap: 1rem;">
                                <div class="search-box">
                                    <input type="text" id="examSearch" placeholder="Cari ujian...">
                                    <i class="fas fa-search"></i>
                                </div>
                                <button class="btn" id="addExamBtn"><i class="fas fa-plus"></i> Buat Ujian</button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Nama Ujian</th>
                                        <th>Mata Pelajaran</th>
                                        <th>Tanggal</th>
                                        <th>Durasi</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="examTableBody">
                                    <!-- Exam rows will be generated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Guru Dashboard -->
                <div id="guruDashboard" class="dashboard-content hidden">
                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-icon blue">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="guruQuestions">0</h3>
                                <p>Soal Saya</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon green">
                                <i class="fas fa-clipboard-list"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="guruExams">0</h3>
                                <p>Ujian Saya</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon orange">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalParticipants">0</h3>
                                <p>Peserta Ujian</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon red">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="guruAvgScore">0</h3>
                                <p>Nilai Rata-rata</p>
                            </div>
                        </div>
                    </div>

                    <div class="content-section">
                        <div class="section-header">
                            <h2>Bank Soal</h2>
                            <div style="display: flex; gap: 1rem;">
                                <div class="search-box">
                                    <input type="text" id="questionSearch" placeholder="Cari soal...">
                                    <i class="fas fa-search"></i>
                                </div>
                                <button class="btn" id="addQuestionBtn"><i class="fas fa-plus"></i> Tambah Soal</button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Pertanyaan</th>
                                        <th>Mata Pelajaran</th>
                                        <th>Tingkat Kesulitan</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="questionTableBody">
                                    <!-- Question rows will be generated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="content-section">
                        <div class="section-header">
                            <h2>Ujian Saya</h2>
                            <div style="display: flex; gap: 1rem;">
                                <div class="search-box">
                                    <input type="text" id="guruExamSearch" placeholder="Cari ujian...">
                                    <i class="fas fa-search"></i>
                                </div>
                                <button class="btn" id="createExamBtn"><i class="fas fa-plus"></i> Buat Ujian Baru</button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Nama Ujian</th>
                                        <th>Tanggal</th>
                                        <th>Jumlah Peserta</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="guruExamTableBody">
                                    <!-- Exam rows will be generated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Siswa Dashboard -->
                <div id="siswaDashboard" class="dashboard-content hidden">
                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-icon blue">
                                <i class="fas fa-clipboard-list"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="availableExams">0</h3>
                                <p>Ujian Tersedia</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon green">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="completedExams">0</h3>
                                <p>Ujian Selesai</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon orange">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="highestScore">0</h3>
                                <p>Nilai Tertinggi</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon red">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="studentAvgScore">0</h3>
                                <p>Nilai Rata-rata</p>
                            </div>
                        </div>
                    </div>

                    <div class="content-section">
                        <div class="section-header">
                            <h2>Ujian Tersedia</h2>
                            <div class="search-box">
                                <input type="text" id="availableExamSearch" placeholder="Cari ujian...">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Nama Ujian</th>
                                        <th>Mata Pelajaran</th>
                                        <th>Tanggal</th>
                                        <th>Durasi</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="availableExamTableBody">
                                    <!-- Available exam rows will be generated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="content-section">
                        <div class="section-header">
                            <h2>Riwayat Ujian</h2>
                            <div class="search-box">
                                <input type="text" id="historySearch" placeholder="Cari riwayat...">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Nama Ujian</th>
                                        <th>Tanggal</th>
                                        <th>Nilai</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="historyTableBody">
                                    <!-- History rows will be generated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Exam Interface -->
    <div id="examInterface" class="hidden">
        <div class="exam-container">
            <div class="exam-header">
                <div>
                    <h3 id="examTitle">Ujian</h3>
                    <p id="examSubject">Mata Pelajaran</p>
                </div>
                <div class="exam-timer" id="examTimer">
                    <i class="fas fa-clock"></i>
                    <span id="timer">00:00</span>
                </div>
            </div>
            
            <div class="exam-content">
                <div class="question-nav" id="questionNav">
                    <!-- Question navigation buttons will be generated by JavaScript -->
                </div>
                
                <div class="question-container" id="questionContainer">
                    <!-- Question content will be generated by JavaScript -->
                </div>
                
                <div class="exam-navigation">
                    <button class="btn" id="prevBtn" onclick="previousQuestion()">
                        <i class="fas fa-arrow-left"></i> Sebelumnya
                    </button>
                    <button class="btn btn-success" id="nextBtn" onclick="nextQuestion()">
                        Selanjutnya <i class="fas fa-arrow-right"></i>
                    </button>
                    <button class="btn btn-danger" id="finishBtn" onclick="finishExam()">
                        <i class="fas fa-stop"></i> Selesai
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">&times;</button>
            <div class="modal-header">
                <h2 id="modalTitle">Modal Title</h2>
            </div>
            <div id="modalBody">
                <!-- Modal content will be generated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <script>
        // Data Management System
        class DataManager {
            constructor() {
                this.initializeData();
            }
            
            initializeData() {
                // Check if data exists in localStorage
                if (!localStorage.getItem('omi-cbt-data')) {
                    // Initialize with default data
                    const defaultData = {
                        users: [
                            { id: 1, username: 'admin', password: this.hashPassword('admin123'), role: 'admin', name: 'Administrator', status: 'active' },
                            { id: 2, username: 'guru', password: this.hashPassword('guru123'), role: 'guru', name: 'Budi Santoso, S.Kom', status: 'active' },
                            { id: 3, username: 'siswa', password: this.hashPassword('siswa123'), role: 'siswa', name: 'Ahmad Leon', status: 'active' }
                        ],
                        questions: [
                            {
                                id: 1,
                                question: "Apa fungsi utama dari RAM dalam komputer?",
                                options: [
                                    "Menyimpan data secara permanen",
                                    "Menyimpan data sementara saat komputer menyala",
                                    "Memproses data",
                                    "Menampilkan output ke layar"
                                ],
                                correctAnswer: 1,
                                subject: "Teknologi Informasi",
                                difficulty: "mudah",
                                createdBy: 2
                            },
                            {
                                id: 2,
                                question: "Jelaskan perbedaan antara LAN dan WAN!",
                                options: [
                                    "LAN lebih cepat dari WAN",
                                    "LAN mencakup area geografis yang lebih luas",
                                    "LAN menggunakan kabel sedangkan WAN menggunakan wireless",
                                    "LAN untuk jaringan lokal, WAN untuk jaringan yang lebih luas"
                                ],
                                correctAnswer: 3,
                                subject: "Teknologi Informasi",
                                difficulty: "sedang",
                                createdBy: 2
                            },
                            {
                                id: 3,
                                question: "Apa yang dimaksud dengan enkripsi data?",
                                options: [
                                    "Proses menghapus data",
                                    "Proses mengompres data",
                                    "Proses mengamankan data dengan mengubahnya menjadi kode",
                                    "Proses memindahkan data"
                                ],
                                correctAnswer: 2,
                                subject: "Teknologi Informasi",
                                difficulty: "sulit",
                                createdBy: 2
                            },
                            {
                                id: 4,
                                question: "Manakah yang bukan termasuk perangkat input?",
                                options: [
                                    "Keyboard",
                                    "Mouse",
                                    "Scanner",
                                    "Monitor"
                                ],
                                correctAnswer: 3,
                                subject: "Teknologi Informasi",
                                difficulty: "mudah",
                                createdBy: 2
                            },
                            {
                                id: 5,
                                question: "Apa kepanjangan dari CPU?",
                                options: [
                                    "Central Processing Unit",
                                    "Computer Personal Unit",
                                    "Central Program Unit",
                                    "Computer Processing Unit"
                                ],
                                correctAnswer: 0,
                                subject: "Teknologi Informasi",
                                difficulty: "mudah",
                                createdBy: 2
                            }
                        ],
                        exams: [
                            {
                                id: 1,
                                name: "Ujian Tengah Semester Ganjil",
                                subject: "Teknologi Informasi",
                                date: "2023-09-25",
                                duration: 90,
                                questionIds: [1, 2, 3, 4, 5],
                                createdBy: 2,
                                status: "active"
                            },
                            {
                                id: 2,
                                name: "Try Out UAMBN",
                                subject: "Keagamaan",
                                date: "2023-09-30",
                                duration: 120,
                                questionIds: [1, 2, 3],
                                createdBy: 2,
                                status: "draft"
                            }
                        ],
                        examResults: [
                            {
                                id: 1,
                                examId: 1,
                                userId: 3,
                                score: 85,
                                answers: {0: 1, 1: 3, 2: 2, 3: 3, 4: 0},
                                startTime: "2023-09-20T10:00:00",
                                endTime: "2023-09-20T11:25:00",
                                status: "completed"
                            },
                            {
                                id: 2,
                                examId: 1,
                                userId: 3,
                                score: 78,
                                answers: {0: 1, 1: 3, 2: 1, 3: 3, 4: 0},
                                startTime: "2023-09-15T09:00:00",
                                endTime: "2023-09-15T10:15:00",
                                status: "completed"
                            }
                        ]
                    };
                    
                    localStorage.setItem('omi-cbt-data', JSON.stringify(defaultData));
                }
            }
            
            getData() {
                return JSON.parse(localStorage.getItem('omi-cbt-data'));
            }
            
            saveData(data) {
                localStorage.setItem('omi-cbt-data', JSON.stringify(data));
            }
            
            hashPassword(password) {
                // Simple hash function for demo purposes
                // In real applications, use a proper hashing library
                let hash = 0;
                for (let i = 0; i < password.length; i++) {
                    const char = password.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // Convert to 32-bit integer
                }
                return hash.toString(16);
            }
            
            // User management
            getUsers() {
                return this.getData().users;
            }
            
            getUserById(id) {
                return this.getUsers().find(user => user.id === id);
            }
            
            getUserByUsername(username) {
                return this.getUsers().find(user => user.username === username);
            }
            
            addUser(user) {
                const data = this.getData();
                const newId = Math.max(...data.users.map(u => u.id), 0) + 1;
                user.id = newId;
                user.password = this.hashPassword(user.password);
                data.users.push(user);
                this.saveData(data);
                return newId;
            }
            
            updateUser(id, updatedUser) {
                const data = this.getData();
                const index = data.users.findIndex(user => user.id === id);
                if (index !== -1) {
                    if (updatedUser.password) {
                        updatedUser.password = this.hashPassword(updatedUser.password);
                    }
                    data.users[index] = { ...data.users[index], ...updatedUser };
                    this.saveData(data);
                    return true;
                }
                return false;
            }
            
            deleteUser(id) {
                const data = this.getData();
                data.users = data.users.filter(user => user.id !== id);
                this.saveData(data);
                return true;
            }
            
            // Question management
            getQuestions() {
                return this.getData().questions;
            }
            
            getQuestionById(id) {
                return this.getQuestions().find(question => question.id === id);
            }
            
            addQuestion(question) {
                const data = this.getData();
                const newId = Math.max(...data.questions.map(q => q.id), 0) + 1;
                question.id = newId;
                data.questions.push(question);
                this.saveData(data);
                return newId;
            }
            
            updateQuestion(id, updatedQuestion) {
                const data = this.getData();
                const index = data.questions.findIndex(question => question.id === id);
                if (index !== -1) {
                    data.questions[index] = { ...data.questions[index], ...updatedQuestion };
                    this.saveData(data);
                    return true;
                }
                return false;
            }
            
            deleteQuestion(id) {
                const data = this.getData();
                data.questions = data.questions.filter(question => question.id !== id);
                this.saveData(data);
                return true;
            }
            
            // Exam management
            getExams() {
                return this.getData().exams;
            }
            
            getExamById(id) {
                return this.getExams().find(exam => exam.id === id);
            }
            
            addExam(exam) {
                const data = this.getData();
                const newId = Math.max(...data.exams.map(e => e.id), 0) + 1;
                exam.id = newId;
                data.exams.push(exam);
                this.saveData(data);
                return newId;
            }
            
            updateExam(id, updatedExam) {
                const data = this.getData();
                const index = data.exams.findIndex(exam => exam.id === id);
                if (index !== -1) {
                    data.exams[index] = { ...data.exams[index], ...updatedExam };
                    this.saveData(data);
                    return true;
                }
                return false;
            }
            
            deleteExam(id) {
                const data = this.getData();
                data.exams = data.exams.filter(exam => exam.id !== id);
                this.saveData(data);
                return true;
            }
            
            // Exam result management
            getExamResults() {
                return this.getData().examResults;
            }
            
            getExamResultsByUserId(userId) {
                return this.getExamResults().filter(result => result.userId === userId);
            }
            
            getExamResultsByExamId(examId) {
                return this.getExamResults().filter(result => result.examId === examId);
            }
            
            addExamResult(result) {
                const data = this.getData();
                const newId = Math.max(...data.examResults.map(r => r.id), 0) + 1;
                result.id = newId;
                data.examResults.push(result);
                this.saveData(data);
                return newId;
            }
            
            updateExamResult(id, updatedResult) {
                const data = this.getData();
                const index = data.examResults.findIndex(result => result.id === id);
                if (index !== -1) {
                    data.examResults[index] = { ...data.examResults[index], ...updatedResult };
                    this.saveData(data);
                    return true;
                }
                return false;
            }
            
            deleteExamResult(id) {
                const data = this.getData();
                data.examResults = data.examResults.filter(result => result.id !== id);
                this.saveData(data);
                return true;
            }
        }

        // Initialize data manager
        const dataManager = new DataManager();

        // Global variables
        let currentUser = null;
        let currentExam = null;
        let currentQuestions = [];
        let currentQuestion = 0;
        let userAnswers = {};
        let examTimer = null;
        let timeRemaining = 0;

        // DOM elements
        const loginPage = document.getElementById('loginPage');
        const mainApp = document.getElementById('mainApp');
        const examInterface = document.getElementById('examInterface');
        const loginForm = document.getElementById('loginForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const welcomeText = document.getElementById('welcomeText');
        const dashboardTitle = document.getElementById('dashboardTitle');
        const dashboardSubtitle = document.getElementById('dashboardSubtitle');
        const adminDashboard = document.getElementById('adminDashboard');
        const guruDashboard = document.getElementById('guruDashboard');
        const siswaDashboard = document.getElementById('siswaDashboard');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const modalClose = document.getElementById('modalClose');
        const toastContainer = document.getElementById('toastContainer');

        // Toast notification function
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = 'fa-info-circle';
            if (type === 'success') icon = 'fa-check-circle';
            if (type === 'error') icon = 'fa-exclamation-circle';
            if (type === 'warning') icon = 'fa-exclamation-triangle';
            
            toast.innerHTML = `<i class="fas ${icon}"></i> ${message}`;
            
            toastContainer.appendChild(toast);
            
            // Show toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // Hide and remove toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // Login functionality
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            
            // Find user
            const user = dataManager.getUserByUsername(username);
            
            if (user && user.role === role && user.password === dataManager.hashPassword(password)) {
                currentUser = user;
                showToast('Login berhasil!', 'success');
                showDashboard();
            } else {
                showToast('Username atau password salah!', 'error');
            }
        });

        // Logout functionality
        logoutBtn.addEventListener('click', function() {
            currentUser = null;
            loginPage.classList.remove('hidden');
            mainApp.classList.add('hidden');
            examInterface.classList.add('hidden');
            loginForm.reset();
            showToast('Anda telah logout', 'info');
        });

        // Show dashboard based on user role
        function showDashboard() {
            loginPage.classList.add('hidden');
            mainApp.classList.remove('hidden');
            
            welcomeText.textContent = `Selamat Datang, ${currentUser.name}`;
            
            // Hide all dashboards
            adminDashboard.classList.add('hidden');
            guruDashboard.classList.add('hidden');
            siswaDashboard.classList.add('hidden');
            
            // Show appropriate dashboard
            switch(currentUser.role) {
                case 'admin':
                    dashboardTitle.textContent = 'Dashboard Admin';
                    dashboardSubtitle.textContent = 'Kelola pengguna, ujian, dan sistem';
                    adminDashboard.classList.remove('hidden');
                    loadAdminDashboard();
                    break;
                case 'guru':
                    dashboardTitle.textContent = 'Dashboard Guru';
                    dashboardSubtitle.textContent = 'Kelola soal dan ujian';
                    guruDashboard.classList.remove('hidden');
                    loadGuruDashboard();
                    break;
                case 'siswa':
                    dashboardTitle.textContent = 'Dashboard Siswa';
                    dashboardSubtitle.textContent = 'Kerjakan ujian dan lihat hasil';
                    siswaDashboard.classList.remove('hidden');
                    loadSiswaDashboard();
                    break;
            }
        }

        // Load Admin Dashboard
        function loadAdminDashboard() {
            // Load statistics
            const users = dataManager.getUsers();
            const questions = dataManager.getQuestions();
            const exams = dataManager.getExams();
            const examResults = dataManager.getExamResults();
            
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalQuestions').textContent = questions.length;
            document.getElementById('totalExams').textContent = exams.length;
            
            // Calculate average score
            if (examResults.length > 0) {
                const totalScore = examResults.reduce((sum, result) => sum + result.score, 0);
                const avgScore = Math.round(totalScore / examResults.length);
                document.getElementById('avgScore').textContent = avgScore + '%';
            } else {
                document.getElementById('avgScore').textContent = '0%';
            }
            
            // Load users table
            loadUsersTable();
            
            // Load exams table
            loadExamsTable();
        }

        // Load Users Table
        function loadUsersTable() {
            const users = dataManager.getUsers();
            const userTableBody = document.getElementById('userTableBody');
            userTableBody.innerHTML = '';
            
            users.forEach((user, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${user.username}</td>
                    <td>${user.name}</td>
                    <td>${user.role.charAt(0).toUpperCase() + user.role.slice(1)}</td>
                    <td>
                        <span class="badge ${user.status === 'active' ? 'badge-success' : 'badge-danger'}">
                            ${user.status === 'active' ? 'Aktif' : 'Nonaktif'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm" onclick="editUser(${user.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteUser(${user.id})">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                        </div>
                    </td>
                `;
                userTableBody.appendChild(row);
            });
        }

        // Load Exams Table
        function loadExamsTable() {
            const exams = dataManager.getExams();
            const examTableBody = document.getElementById('examTableBody');
            examTableBody.innerHTML = '';
            
            exams.forEach((exam, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${exam.name}</td>
                    <td>${exam.subject}</td>
                    <td>${new Date(exam.date).toLocaleDateString('id-ID')}</td>
                    <td>${exam.duration} menit</td>
                    <td>
                        <span class="badge ${exam.status === 'active' ? 'badge-success' : exam.status === 'draft' ? 'badge-warning' : 'badge-danger'}">
                            ${exam.status === 'active' ? 'Aktif' : exam.status === 'draft' ? 'Draft' : 'Selesai'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm" onclick="viewExam(${exam.id})">
                                <i class="fas fa-eye"></i> Detail
                            </button>
                            <button class="btn btn-sm" onclick="editExam(${exam.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteExam(${exam.id})">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                        </div>
                    </td>
                `;
                examTableBody.appendChild(row);
            });
        }

        // Load Guru Dashboard
        function loadGuruDashboard() {
            const questions = dataManager.getQuestions().filter(q => q.createdBy === currentUser.id);
            const exams = dataManager.getExams().filter(e => e.createdBy === currentUser.id);
            const examResults = dataManager.getExamResults().filter(r => {
                const exam = dataManager.getExamById(r.examId);
                return exam && exam.createdBy === currentUser.id;
            });
            
            document.getElementById('guruQuestions').textContent = questions.length;
            document.getElementById('guruExams').textContent = exams.length;
            
            // Calculate total participants
            const participants = new Set();
            examResults.forEach(result => participants.add(result.userId));
            document.getElementById('totalParticipants').textContent = participants.size;
            
            // Calculate average score
            if (examResults.length > 0) {
                const totalScore = examResults.reduce((sum, result) => sum + result.score, 0);
                const avgScore = Math.round(totalScore / examResults.length);
                document.getElementById('guruAvgScore').textContent = avgScore;
            } else {
                document.getElementById('guruAvgScore').textContent = '0';
            }
            
            // Load questions table
            loadQuestionsTable();
            
            // Load guru exams table
            loadGuruExamsTable();
        }

        // Load Questions Table
        function loadQuestionsTable() {
            const questions = dataManager.getQuestions().filter(q => q.createdBy === currentUser.id);
            const questionTableBody = document.getElementById('questionTableBody');
            questionTableBody.innerHTML = '';
            
            questions.forEach((question, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${question.question.substring(0, 50)}${question.question.length > 50 ? '...' : ''}</td>
                    <td>${question.subject}</td>
                    <td>
                        <span class="badge ${question.difficulty === 'mudah' ? 'badge-success' : question.difficulty === 'sedang' ? 'badge-warning' : 'badge-danger'}">
                            ${question.difficulty.charAt(0).toUpperCase() + question.difficulty.slice(1)}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm" onclick="viewQuestion(${question.id})">
                                <i class="fas fa-eye"></i> Lihat
                            </button>
                            <button class="btn btn-sm" onclick="editQuestion(${question.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteQuestion(${question.id})">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                        </div>
                    </td>
                `;
                questionTableBody.appendChild(row);
            });
        }

        // Load Guru Exams Table
        function loadGuruExamsTable() {
            const exams = dataManager.getExams().filter(e => e.createdBy === currentUser.id);
            const guruExamTableBody = document.getElementById('guruExamTableBody');
            guruExamTableBody.innerHTML = '';
            
            exams.forEach((exam, index) => {
                const results = dataManager.getExamResultsByExamId(exam.id);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${exam.name}</td>
                    <td>${new Date(exam.date).toLocaleDateString('id-ID')}</td>
                    <td>${results.length}</td>
                    <td>
                        <span class="badge ${exam.status === 'active' ? 'badge-success' : exam.status === 'draft' ? 'badge-warning' : 'badge-danger'}">
                            ${exam.status === 'active' ? 'Aktif' : exam.status === 'draft' ? 'Draft' : 'Selesai'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm" onclick="viewExam(${exam.id})">
                                <i class="fas fa-eye"></i> Detail
                            </button>
                            ${exam.status === 'active' ? `<button class="btn btn-sm btn-info" onclick="monitorExam(${exam.id})">
                                <i class="fas fa-desktop"></i> Monitor
                            </button>` : ''}
                            <button class="btn btn-sm" onclick="editExam(${exam.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteExam(${exam.id})">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                        </div>
                    </td>
                `;
                guruExamTableBody.appendChild(row);
            });
        }

        // Load Siswa Dashboard
        function loadSiswaDashboard() {
            const exams = dataManager.getExams().filter(e => e.status === 'active');
            const results = dataManager.getExamResultsByUserId(currentUser.id);
            
            document.getElementById('availableExams').textContent = exams.length;
            document.getElementById('completedExams').textContent = results.length;
            
            // Calculate highest score
            if (results.length > 0) {
                const highestScore = Math.max(...results.map(r => r.score));
                document.getElementById('highestScore').textContent = highestScore;
                
                // Calculate average score
                const totalScore = results.reduce((sum, result) => sum + result.score, 0);
                const avgScore = Math.round(totalScore / results.length);
                document.getElementById('studentAvgScore').textContent = avgScore;
            } else {
                document.getElementById('highestScore').textContent = '0';
                document.getElementById('studentAvgScore').textContent = '0';
            }
            
            // Load available exams table
            loadAvailableExamsTable();
            
            // Load history table
            loadHistoryTable();
        }

        // Load Available Exams Table
        function loadAvailableExamsTable() {
            const exams = dataManager.getExams().filter(e => e.status === 'active');
            const availableExamTableBody = document.getElementById('availableExamTableBody');
            availableExamTableBody.innerHTML = '';
            
            exams.forEach((exam, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${exam.name}</td>
                    <td>${exam.subject}</td>
                    <td>${new Date(exam.date).toLocaleDateString('id-ID')}</td>
                    <td>${exam.duration} menit</td>
                    <td>
                        <span class="badge badge-success">Tersedia</span>
                    </td>
                    <td>
                        <button class="btn btn-sm" onclick="startExam(${exam.id})">
                            <i class="fas fa-play"></i> Kerjakan
                        </button>
                    </td>
                `;
                availableExamTableBody.appendChild(row);
            });
        }

        // Load History Table
        function loadHistoryTable() {
            const results = dataManager.getExamResultsByUserId(currentUser.id);
            const historyTableBody = document.getElementById('historyTableBody');
            historyTableBody.innerHTML = '';
            
            results.forEach((result, index) => {
                const exam = dataManager.getExamById(result.examId);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${exam ? exam.name : 'Ujian tidak ditemukan'}</td>
                    <td>${new Date(result.startTime).toLocaleDateString('id-ID')}</td>
                    <td>${result.score}</td>
                    <td>
                        <span class="badge ${result.score >= 70 ? 'badge-success' : 'badge-danger'}">
                            ${result.score >= 70 ? 'Lulus' : 'Tidak Lulus'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm" onclick="viewResult(${result.id})">
                                <i class="fas fa-eye"></i> Detail
                            </button>
                        </div>
                    </td>
                `;
                historyTableBody.appendChild(row);
            });
        }

        // Start exam
        function startExam(examId) {
            currentExam = dataManager.getExamById(examId);
            if (!currentExam) {
                showToast('Ujian tidak ditemukan!', 'error');
                return;
            }
            
            // Get questions for this exam
            currentQuestions = currentExam.questionIds.map(id => dataManager.getQuestionById(id));
            
            // Shuffle questions for randomness
            currentQuestions = shuffleArray(currentQuestions);
            
            // Initialize exam
            currentQuestion = 0;
            userAnswers = {};
            timeRemaining = currentExam.duration * 60; // Convert minutes to seconds
            
            // Show exam interface
            mainApp.classList.add('hidden');
            examInterface.classList.remove('hidden');
            
            // Set exam title and subject
            document.getElementById('examTitle').textContent = currentExam.name;
            document.getElementById('examSubject').textContent = currentExam.subject;
            
            // Generate question navigation
            generateQuestionNav();
            
            // Show first question
            showQuestion(0);
            
            // Start timer
            startExamTimer();
            
            showToast('Ujian dimulai!', 'info');
        }

        // Shuffle array function
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Generate question navigation
        function generateQuestionNav() {
            const questionNav = document.getElementById('questionNav');
            questionNav.innerHTML = '';
            
            for (let i = 0; i < currentQuestions.length; i++) {
                const button = document.createElement('button');
                button.className = 'question-btn';
                button.textContent = i + 1;
                button.onclick = () => showQuestion(i);
                questionNav.appendChild(button);
            }
        }

        // Show question
        function showQuestion(index) {
            currentQuestion = index;
            const question = currentQuestions[index];
            
            const questionContainer = document.getElementById('questionContainer');
            questionContainer.innerHTML = `
                <div class="question-number">Pertanyaan ${index + 1}</div>
                <div class="question-text">${question.question}</div>
                <div class="options">
                    ${question.options.map((option, i) => `
                        <div class="option" onclick="selectOption(${i})">
                            <input type="radio" id="option${i}" name="answer" value="${i}" ${userAnswers[index] === i ? 'checked' : ''}>
                            <label for="option${i}">${option}</label>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Add event listeners to options
            const options = questionContainer.querySelectorAll('input[type="radio"]');
            options.forEach(option => {
                option.addEventListener('change', function() {
                    userAnswers[index] = parseInt(this.value);
                    updateQuestionNav();
                });
            });
            
            // Update navigation buttons
            updateNavigationButtons();
            
            // Update question navigation
            updateQuestionNav();
        }

        // Select option
        function selectOption(index) {
            userAnswers[currentQuestion] = index;
            document.getElementById(`option${index}`).checked = true;
            
            // Update option styling
            const options = document.querySelectorAll('.option');
            options.forEach((option, i) => {
                if (i === index) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
            
            updateQuestionNav();
        }

        // Update question navigation
        function updateQuestionNav() {
            const questionNav = document.getElementById('questionNav');
            const buttons = questionNav.querySelectorAll('.question-btn');
            
            buttons.forEach((button, index) => {
                button.classList.remove('active', 'answered');
                
                if (index === currentQuestion) {
                    button.classList.add('active');
                }
                
                if (userAnswers[index] !== undefined) {
                    button.classList.add('answered');
                }
            });
        }

        // Update navigation buttons
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const finishBtn = document.getElementById('finishBtn');
            
            prevBtn.disabled = currentQuestion === 0;
            
            if (currentQuestion === currentQuestions.length - 1) {
                nextBtn.style.display = 'none';
                finishBtn.style.display = 'inline-block';
            } else {
                nextBtn.style.display = 'inline-block';
                finishBtn.style.display = 'none';
            }
        }

        // Previous question
        function previousQuestion() {
            if (currentQuestion > 0) {
                showQuestion(currentQuestion - 1);
            }
        }

        // Next question
        function nextQuestion() {
            if (currentQuestion < currentQuestions.length - 1) {
                showQuestion(currentQuestion + 1);
            }
        }

        // Start exam timer
        function startExamTimer() {
            examTimer = setInterval(() => {
                timeRemaining--;
                
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                
                const timerElement = document.getElementById('timer');
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Change timer color when time is running out
                const examTimerElement = document.getElementById('examTimer');
                if (timeRemaining <= 60) {
                    examTimerElement.classList.add('danger');
                } else if (timeRemaining <= 300) {
                    examTimerElement.classList.add('warning');
                }
                
                if (timeRemaining <= 0) {
                    finishExam();
                }
            }, 1000);
        }

        // Finish exam
        function finishExam() {
            clearInterval(examTimer);
            
            // Calculate score
            let correctAnswers = 0;
            for (let i = 0; i < currentQuestions.length; i++) {
                const question = currentQuestions[i];
                if (userAnswers[i] === question.correctAnswer) {
                    correctAnswers++;
                }
            }
            
            const score = Math.round((correctAnswers / currentQuestions.length) * 100);
            
            // Save exam result
            const result = {
                examId: currentExam.id,
                userId: currentUser.id,
                score: score,
                answers: userAnswers,
                startTime: new Date().toISOString(),
                endTime: new Date().toISOString(),
                status: "completed"
            };
            
            dataManager.addExamResult(result);
            
            // Show result
            modalTitle.textContent = 'Hasil Ujian';
            modalBody.innerHTML = `
                <div class="text-center">
                    <h3>Ujian Selesai!</h3>
                    <p>Anda telah menyelesaikan ujian dengan hasil:</p>
                    <div style="font-size: 3rem; font-weight: bold; color: var(--primary-color); margin: 1rem 0;">
                        ${score}
                    </div>
                    <p>Jawaban Benar: ${correctAnswers} dari ${currentQuestions.length} soal</p>
                    <div class="mt-3">
                        <button class="btn" onclick="closeModalAndReturnToDashboard()">
                            <i class="fas fa-arrow-left"></i> Kembali ke Dashboard
                        </button>
                    </div>
                </div>
            `;
            modal.classList.add('active');
            
            showToast('Ujian selesai!', 'success');
        }

        // Close modal and return to dashboard
        function closeModalAndReturnToDashboard() {
            modal.classList.remove('active');
            examInterface.classList.add('hidden');
            mainApp.classList.remove('hidden');
            
            // Reload dashboard to update statistics
            if (currentUser.role === 'siswa') {
                loadSiswaDashboard();
            }
        }

        // Modal close event
        modalClose.addEventListener('click', () => {
            modal.classList.remove('active');
        });

        // Modal close when clicking outside
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
            }
        });

        // Add user button
        document.getElementById('addUserBtn')?.addEventListener('click', () => {
            modalTitle.textContent = 'Tambah Pengguna';
            modalBody.innerHTML = `
                <form id="addUserForm">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="newUsername" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="newPassword" required>
                    </div>
                    <div class="form-group">
                        <label>Nama Lengkap</label>
                        <input type="text" id="newFullName" required>
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <select id="newRole" required>
                            <option value="">Pilih Role</option>
                            <option value="admin">Admin</option>
                            <option value="guru">Guru</option>
                            <option value="siswa">Siswa</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="newStatus" required>
                            <option value="active">Aktif</option>
                            <option value="inactive">Nonaktif</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button type="button" class="btn" onclick="modal.classList.remove('active')">Batal</button>
                        <button type="submit" class="btn btn-success">Simpan</button>
                    </div>
                </form>
            `;
            modal.classList.add('active');
            
            // Handle form submission
            document.getElementById('addUserForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const username = document.getElementById('newUsername').value;
                const password = document.getElementById('newPassword').value;
                const fullName = document.getElementById('newFullName').value;
                const role = document.getElementById('newRole').value;
                const status = document.getElementById('newStatus').value;
                
                // Check if username already exists
                if (dataManager.getUserByUsername(username)) {
                    showToast('Username sudah digunakan!', 'error');
                    return;
                }
                
                // Add user
                const newUser = {
                    username: username,
                    password: password,
                    name: fullName,
                    role: role,
                    status: status
                };
                
                dataManager.addUser(newUser);
                showToast('Pengguna berhasil ditambahkan!', 'success');
                modal.classList.remove('active');
                loadUsersTable();
                loadAdminDashboard();
            });
        });

        // Edit user function
        function editUser(userId) {
            const user = dataManager.getUserById(userId);
            if (!user) {
                showToast('Pengguna tidak ditemukan!', 'error');
                return;
            }
            
            modalTitle.textContent = 'Edit Pengguna';
            modalBody.innerHTML = `
                <form id="editUserForm">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="editUsername" value="${user.username}" required>
                    </div>
                    <div class="form-group">
                        <label>Password (kosongkan jika tidak diubah)</label>
                        <input type="password" id="editPassword">
                    </div>
                    <div class="form-group">
                        <label>Nama Lengkap</label>
                        <input type="text" id="editFullName" value="${user.name}" required>
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <select id="editRole" required>
                            <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Admin</option>
                            <option value="guru" ${user.role === 'guru' ? 'selected' : ''}>Guru</option>
                            <option value="siswa" ${user.role === 'siswa' ? 'selected' : ''}>Siswa</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="editStatus" required>
                            <option value="active" ${user.status === 'active' ? 'selected' : ''}>Aktif</option>
                            <option value="inactive" ${user.status === 'inactive' ? 'selected' : ''}>Nonaktif</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button type="button" class="btn" onclick="modal.classList.remove('active')">Batal</button>
                        <button type="submit" class="btn btn-success">Simpan</button>
                    </div>
                </form>
            `;
            modal.classList.add('active');
            
            // Handle form submission
            document.getElementById('editUserForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const username = document.getElementById('editUsername').value;
                const password = document.getElementById('editPassword').value;
                const fullName = document.getElementById('editFullName').value;
                const role = document.getElementById('editRole').value;
                const status = document.getElementById('editStatus').value;
                
                // Check if username already exists (excluding current user)
                const existingUser = dataManager.getUserByUsername(username);
                if (existingUser && existingUser.id !== userId) {
                    showToast('Username sudah digunakan!', 'error');
                    return;
                }
                
                // Update user
                const updatedUser = {
                    username: username,
                    name: fullName,
                    role: role,
                    status: status
                };
                
                if (password) {
                    updatedUser.password = password;
                }
                
                dataManager.updateUser(userId, updatedUser);
                showToast('Pengguna berhasil diperbarui!', 'success');
                modal.classList.remove('active');
                loadUsersTable();
                loadAdminDashboard();
            });
        }

        // Delete user function
        function deleteUser(userId) {
            if (confirm('Apakah Anda yakin ingin menghapus pengguna ini?')) {
                dataManager.deleteUser(userId);
                showToast('Pengguna berhasil dihapus!', 'success');
                loadUsersTable();
                loadAdminDashboard();
            }
        }

        // Add exam button
        document.getElementById('addExamBtn')?.addEventListener('click', () => {
            const questions = dataManager.getQuestions();
            
            modalTitle.textContent = 'Buat Ujian Baru';
            modalBody.innerHTML = `
                <form id="addExamForm">
                    <div class="form-group">
                        <label>Nama Ujian</label>
                        <input type="text" id="newExamName" required>
                    </div>
                    <div class="form-group">
                        <label>Mata Pelajaran</label>
                        <input type="text" id="newExamSubject" required>
                    </div>
                    <div class="form-group">
                        <label>Tanggal</label>
                        <input type="date" id="newExamDate" required>
                    </div>
                    <div class="form-group">
                        <label>Durasi (menit)</label>
                        <input type="number" id="newExamDuration" min="1" required>
                    </div>
                    <div class="form-group">
                        <label>Pilih Soal</label>
                        <div style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); padding: 0.5rem; border-radius: 5px;">
                            ${questions.map((question, index) => `
                                <label style="display: block; margin-bottom: 0.5rem;">
                                    <input type="checkbox" name="examQuestions" value="${question.id}"> 
                                    ${question.question.substring(0, 50)}${question.question.length > 50 ? '...' : ''}
                                </label>
                            `).join('')}
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="newExamStatus" required>
                            <option value="draft">Draft</option>
                            <option value="active">Aktif</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button type="button" class="btn" onclick="modal.classList.remove('active')">Batal</button>
                        <button type="submit" class="btn btn-success">Simpan</button>
                    </div>
                </form>
            `;
            modal.classList.add('active');
            
            // Handle form submission
            document.getElementById('addExamForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const name = document.getElementById('newExamName').value;
                const subject = document.getElementById('newExamSubject').value;
                const date = document.getElementById('newExamDate').value;
                const duration = parseInt(document.getElementById('newExamDuration').value);
                const status = document.getElementById('newExamStatus').value;
                
                // Get selected questions
                const selectedQuestions = [];
                const checkboxes = document.querySelectorAll('input[name="examQuestions"]:checked');
                checkboxes.forEach(checkbox => {
                    selectedQuestions.push(parseInt(checkbox.value));
                });
                
                if (selectedQuestions.length === 0) {
                    showToast('Pilih minimal satu soal!', 'error');
                    return;
                }
                
                // Add exam
                const newExam = {
                    name: name,
                    subject: subject,
                    date: date,
                    duration: duration,
                    questionIds: selectedQuestions,
                    createdBy: currentUser.id,
                    status: status
                };
                
                dataManager.addExam(newExam);
                showToast('Ujian berhasil dibuat!', 'success');
                modal.classList.remove('active');
                loadExamsTable();
                loadAdminDashboard();
            });
        });

        // View exam function
        function viewExam(examId) {
            const exam = dataManager.getExamById(examId);
            if (!exam) {
                showToast('Ujian tidak ditemukan!', 'error');
                return;
            }
            
            const questions = exam.questionIds.map(id => dataManager.getQuestionById(id));
            const results = dataManager.getExamResultsByExamId(examId);
            
            modalTitle.textContent = 'Detail Ujian';
            modalBody.innerHTML = `
                <div>
                    <h3>${exam.name}</h3>
                    <p><strong>Mata Pelajaran:</strong> ${exam.subject}</p>
                    <p><strong>Tanggal:</strong> ${new Date(exam.date).toLocaleDateString('id-ID')}</p>
                    <p><strong>Durasi:</strong> ${exam.duration} menit</p>
                    <p><strong>Status:</strong> 
                        <span class="badge ${exam.status === 'active' ? 'badge-success' : exam.status === 'draft' ? 'badge-warning' : 'badge-danger'}">
                            ${exam.status === 'active' ? 'Aktif' : exam.status === 'draft' ? 'Draft' : 'Selesai'}
                        </span>
                    </p>
                    <p><strong>Jumlah Soal:</strong> ${questions.length}</p>
                    <p><strong>Jumlah Peserta:</strong> ${results.length}</p>
                    
                    <h4 class="mt-3 mb-2">Daftar Soal</h4>
                    <div style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); padding: 0.5rem; border-radius: 5px;">
                        ${questions.map((question, index) => `
                            <div class="mb-2">
                                <strong>${index + 1}.</strong> ${question.question}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="mt-3 text-center">
                        <button class="btn" onclick="modal.classList.remove('active')">Tutup</button>
                    </div>
                </div>
            `;
            modal.classList.add('active');
        }

        // Edit exam function
        function editExam(examId) {
            const exam = dataManager.getExamById(examId);
            if (!exam) {
                showToast('Ujian tidak ditemukan!', 'error');
                return;
            }
            
            const questions = dataManager.getQuestions();
            
            modalTitle.textContent = 'Edit Ujian';
            modalBody.innerHTML = `
                <form id="editExamForm">
                    <div class="form-group">
                        <label>Nama Ujian</label>
                        <input type="text" id="editExamName" value="${exam.name}" required>
                    </div>
                    <div class="form-group">
                        <label>Mata Pelajaran</label>
                        <input type="text" id="editExamSubject" value="${exam.subject}" required>
                    </div>
                    <div class="form-group">
                        <label>Tanggal</label>
                        <input type="date" id="editExamDate" value="${exam.date}" required>
                    </div>
                    <div class="form-group">
                        <label>Durasi (menit)</label>
                        <input type="number" id="editExamDuration" value="${exam.duration}" min="1" required>
                    </div>
                    <div class="form-group">
                        <label>Pilih Soal</label>
                        <div style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); padding: 0.5rem; border-radius: 5px;">
                            ${questions.map((question, index) => `
                                <label style="display: block; margin-bottom: 0.5rem;">
                                    <input type="checkbox" name="editExamQuestions" value="${question.id}" ${exam.questionIds.includes(question.id) ? 'checked' : ''}> 
                                    ${question.question.substring(0, 50)}${question.question.length > 50 ? '...' : ''}
                                </label>
                            `).join('')}
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="editExamStatus" required>
                            <option value="draft" ${exam.status === 'draft' ? 'selected' : ''}>Draft</option>
                            <option value="active" ${exam.status === 'active' ? 'selected' : ''}>Aktif</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button type="button" class="btn" onclick="modal.classList.remove('active')">Batal</button>
                        <button type="submit" class="btn btn-success">Simpan</button>
                    </div>
                </form>
            `;
            modal.classList.add('active');
            
            // Handle form submission
            document.getElementById('editExamForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const name = document.getElementById('editExamName').value;
                const subject = document.getElementById('editExamSubject').value;
                const date = document.getElementById('editExamDate').value;
                const duration = parseInt(document.getElementById('editExamDuration').value);
                const status = document.getElementById('editExamStatus').value;
                
                // Get selected questions
                const selectedQuestions = [];
                const checkboxes = document.querySelectorAll('input[name="editExamQuestions"]:checked');
                checkboxes.forEach(checkbox => {
                    selectedQuestions.push(parseInt(checkbox.value));
                });
                
                if (selectedQuestions.length === 0) {
                    showToast('Pilih minimal satu soal!', 'error');
                    return;
                }
                
                // Update exam
                const updatedExam = {
                    name: name,
                    subject: subject,
                    date: date,
                    duration: duration,
                    questionIds: selectedQuestions,
                    status: status
                };
                
                dataManager.updateExam(examId, updatedExam);
                showToast('Ujian berhasil diperbarui!', 'success');
                modal.classList.remove('active');
                loadExamsTable();
                loadAdminDashboard();
            });
        }

        // Delete exam function
        function deleteExam(examId) {
            if (confirm('Apakah Anda yakin ingin menghapus ujian ini?')) {
                dataManager.deleteExam(examId);
                showToast('Ujian berhasil dihapus!', 'success');
                loadExamsTable();
                loadAdminDashboard();
            }
        }

        // Add question button
        document.getElementById('addQuestionBtn')?.addEventListener('click', () => {
            modalTitle.textContent = 'Tambah Soal Baru';
            modalBody.innerHTML = `
                <form id="addQuestionForm">
                    <div class="form-group">
                        <label>Pertanyaan</label>
                        <textarea id="newQuestion" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Opsi A</label>
                        <input type="text" id="newOptionA" required>
                    </div>
                    <div class="form-group">
                        <label>Opsi B</label>
                        <input type="text" id="newOptionB" required>
                    </div>
                    <div class="form-group">
                        <label>Opsi C</label>
                        <input type="text" id="newOptionC" required>
                    </div>
                    <div class="form-group">
                        <label>Opsi D</label>
                        <input type="text" id="newOptionD" required>
                    </div>
                    <div class="form-group">
                        <label>Jawaban Benar</label>
                        <select id="newCorrectAnswer" required>
                            <option value="">Pilih Jawaban</option>
                            <option value="0">A</option>
                            <option value="1">B</option>
                            <option value="2">C</option>
                            <option value="3">D</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Mata Pelajaran</label>
                        <input type="text" id="newQuestionSubject" required>
                    </div>
                    <div class="form-group">
                        <label>Tingkat Kesulitan</label>
                        <select id="newQuestionDifficulty" required>
                            <option value="">Pilih Tingkat</option>
                            <option value="mudah">Mudah</option>
                            <option value="sedang">Sedang</option>
                            <option value="sulit">Sulit</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button type="button" class="btn" onclick="modal.classList.remove('active')">Batal</button>
                        <button type="submit" class="btn btn-success">Simpan</button>
                    </div>
                </form>
            `;
            modal.classList.add('active');
            
            // Handle form submission
            document.getElementById('addQuestionForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const question = document.getElementById('newQuestion').value;
                const optionA = document.getElementById('newOptionA').value;
                const optionB = document.getElementById('newOptionB').value;
                const optionC = document.getElementById('newOptionC').value;
                const optionD = document.getElementById('newOptionD').value;
                const correctAnswer = parseInt(document.getElementById('newCorrectAnswer').value);
                const subject = document.getElementById('newQuestionSubject').value;
                const difficulty = document.getElementById('newQuestionDifficulty').value;
                
                // Add question
                const newQuestion = {
                    question: question,
                    options: [optionA, optionB, optionC, optionD],
                    correctAnswer: correctAnswer,
                    subject: subject,
                    difficulty: difficulty,
                    createdBy: currentUser.id
                };
                
                dataManager.addQuestion(newQuestion);
                showToast('Soal berhasil ditambahkan!', 'success');
                modal.classList.remove('active');
                loadQuestionsTable();
                loadGuruDashboard();
            });
        });

        // View question function
        function viewQuestion(questionId) {
            const question = dataManager.getQuestionById(questionId);
            if (!question) {
                showToast('Soal tidak ditemukan!', 'error');
                return;
            }
            
            modalTitle.textContent = 'Detail Soal';
            modalBody.innerHTML = `
                <div>
                    <h4>${question.question}</h4>
                    <div class="mt-2">
                        <p><strong>A.</strong> ${question.options[0]}</p>
                        <p><strong>B.</strong> ${question.options[1]}</p>
                        <p><strong>C.</strong> ${question.options[2]}</p>
                        <p><strong>D.</strong> ${question.options[3]}</p>
                    </div>
                    <p class="mt-2"><strong>Jawaban Benar:</strong> ${String.fromCharCode(65 + question.correctAnswer)}</p>
                    <p><strong>Mata Pelajaran:</strong> ${question.subject}</p>
                    <p><strong>Tingkat Kesulitan:</strong> 
                        <span class="badge ${question.difficulty === 'mudah' ? 'badge-success' : question.difficulty === 'sedang' ? 'badge-warning' : 'badge-danger'}">
                            ${question.difficulty.charAt(0).toUpperCase() + question.difficulty.slice(1)}
                        </span>
                    </p>
                    
                    <div class="mt-3 text-center">
                        <button class="btn" onclick="modal.classList.remove('active')">Tutup</button>
                    </div>
                </div>
            `;
            modal.classList.add('active');
        }

        // Edit question function
        function editQuestion(questionId) {
            const question = dataManager.getQuestionById(questionId);
            if (!question) {
                showToast('Soal tidak ditemukan!', 'error');
                return;
            }
            
            modalTitle.textContent = 'Edit Soal';
            modalBody.innerHTML = `
                <form id="editQuestionForm">
                    <div class="form-group">
                        <label>Pertanyaan</label>
                        <textarea id="editQuestion" rows="3" required>${question.question}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Opsi A</label>
                        <input type="text" id="editOptionA" value="${question.options[0]}" required>
                    </div>
                    <div class="form-group">
                        <label>Opsi B</label>
                        <input type="text" id="editOptionB" value="${question.options[1]}" required>
                    </div>
                    <div class="form-group">
                        <label>Opsi C</label>
                        <input type="text" id="editOptionC" value="${question.options[2]}" required>
                    </div>
                    <div class="form-group">
                        <label>Opsi D</label>
                        <input type="text" id="editOptionD" value="${question.options[3]}" required>
                    </div>
                    <div class="form-group">
                        <label>Jawaban Benar</label>
                        <select id="editCorrectAnswer" required>
                            <option value="0" ${question.correctAnswer === 0 ? 'selected' : ''}>A</option>
                            <option value="1" ${question.correctAnswer === 1 ? 'selected' : ''}>B</option>
                            <option value="2" ${question.correctAnswer === 2 ? 'selected' : ''}>C</option>
                            <option value="3" ${question.correctAnswer === 3 ? 'selected' : ''}>D</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Mata Pelajaran</label>
                        <input type="text" id="editQuestionSubject" value="${question.subject}" required>
                    </div>
                    <div class="form-group">
                        <label>Tingkat Kesulitan</label>
                        <select id="editQuestionDifficulty" required>
                            <option value="mudah" ${question.difficulty === 'mudah' ? 'selected' : ''}>Mudah</option>
                            <option value="sedang" ${question.difficulty === 'sedang' ? 'selected' : ''}>Sedang</option>
                            <option value="sulit" ${question.difficulty === 'sulit' ? 'selected' : ''}>Sulit</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button type="button" class="btn" onclick="modal.classList.remove('active')">Batal</button>
                        <button type="submit" class="btn btn-success">Simpan</button>
                    </div>
                </form>
            `;
            modal.classList.add('active');
            
            // Handle form submission
            document.getElementById('editQuestionForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const questionText = document.getElementById('editQuestion').value;
                const optionA = document.getElementById('editOptionA').value;
                const optionB = document.getElementById('editOptionB').value;
                const optionC = document.getElementById('editOptionC').value;
                const optionD = document.getElementById('editOptionD').value;
                const correctAnswer = parseInt(document.getElementById('editCorrectAnswer').value);
                const subject = document.getElementById('editQuestionSubject').value;
                const difficulty = document.getElementById('editQuestionDifficulty').value;
                
                // Update question
                const updatedQuestion = {
                    question: questionText,
                    options: [optionA, optionB, optionC, optionD],
                    correctAnswer: correctAnswer,
                    subject: subject,
                    difficulty: difficulty
                };
                
                dataManager.updateQuestion(questionId, updatedQuestion);
                showToast('Soal berhasil diperbarui!', 'success');
                modal.classList.remove('active');
                loadQuestionsTable();
                loadGuruDashboard();
            });
        });

        // Delete question function
        function deleteQuestion(questionId) {
            if (confirm('Apakah Anda yakin ingin menghapus soal ini?')) {
                dataManager.deleteQuestion(questionId);
                showToast('Soal berhasil dihapus!', 'success');
                loadQuestionsTable();
                loadGuruDashboard();
            }
        }

        // Create exam button for guru
        document.getElementById('createExamBtn')?.addEventListener('click', () => {
            const questions = dataManager.getQuestions().filter(q => q.createdBy === currentUser.id);
            
            modalTitle.textContent = 'Buat Ujian Baru';
            modalBody.innerHTML = `
                <form id="createExamForm">
                    <div class="form-group">
                        <label>Nama Ujian</label>
                        <input type="text" id="createExamName" required>
                    </div>
                    <div class="form-group">
                        <label>Mata Pelajaran</label>
                        <input type="text" id="createExamSubject" required>
                    </div>
                    <div class="form-group">
                        <label>Tanggal</label>
                        <input type="date" id="createExamDate" required>
                    </div>
                    <div class="form-group">
                        <label>Durasi (menit)</label>
                        <input type="number" id="createExamDuration" min="1" required>
                    </div>
                    <div class="form-group">
                        <label>Pilih Soal dari Bank Soal</label>
                        <div style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); padding: 0.5rem; border-radius: 5px;">
                            ${questions.map((question, index) => `
                                <label style="display: block; margin-bottom: 0.5rem;">
                                    <input type="checkbox" name="createExamQuestions" value="${question.id}"> 
                                    ${question.question.substring(0, 50)}${question.question.length > 50 ? '...' : ''}
                                </label>
                            `).join('')}
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="createExamStatus" required>
                            <option value="draft">Draft</option>
                            <option value="active">Aktif</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button type="button" class="btn" onclick="modal.classList.remove('active')">Batal</button>
                        <button type="submit" class="btn btn-success">Simpan</button>
                    </div>
                </form>
            `;
            modal.classList.add('active');
            
            // Handle form submission
            document.getElementById('createExamForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const name = document.getElementById('createExamName').value;
                const subject = document.getElementById('createExamSubject').value;
                const date = document.getElementById('createExamDate').value;
                const duration = parseInt(document.getElementById('createExamDuration').value);
                const status = document.getElementById('createExamStatus').value;
                
                // Get selected questions
                const selectedQuestions = [];
                const checkboxes = document.querySelectorAll('input[name="createExamQuestions"]:checked');
                checkboxes.forEach(checkbox => {
                    selectedQuestions.push(parseInt(checkbox.value));
                });
                
                if (selectedQuestions.length === 0) {
                    showToast('Pilih minimal satu soal!', 'error');
                    return;
                }
                
                // Add exam
                const newExam = {
                    name: name,
                    subject: subject,
                    date: date,
                    duration: duration,
                    questionIds: selectedQuestions,
                    createdBy: currentUser.id,
                    status: status
                };
                
                dataManager.addExam(newExam);
                showToast('Ujian berhasil dibuat!', 'success');
                modal.classList.remove('active');
                loadGuruExamsTable();
                loadGuruDashboard();
            });
        });

        // Monitor exam function
        function monitorExam(examId) {
            const exam = dataManager.getExamById(examId);
            if (!exam) {
                showToast('Ujian tidak ditemukan!', 'error');
                return;
            }
            
            const results = dataManager.getExamResultsByExamId(examId);
            
            modalTitle.textContent = 'Monitor Ujian';
            modalBody.innerHTML = `
                <div>
                    <h3>${exam.name}</h3>
                    <p><strong>Mata Pelajaran:</strong> ${exam.subject}</p>
                    <p><strong>Jumlah Peserta:</strong> ${results.length}</p>
                    
                    <h4 class="mt-3 mb-2">Hasil Ujian</h4>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Nama Siswa</th>
                                    <th>Nilai</th>
                                    <th>Status</th>
                                    <th>Waktu</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${results.map((result, index) => {
                                    const user = dataManager.getUserById(result.userId);
                                    return `
                                        <tr>
                                            <td>${index + 1}</td>
                                            <td>${user ? user.name : 'Pengguna tidak ditemukan'}</td>
                                            <td>${result.score}</td>
                                            <td>
                                                <span class="badge ${result.score >= 70 ? 'badge-success' : 'badge-danger'}">
                                                    ${result.score >= 70 ? 'Lulus' : 'Tidak Lulus'}
                                                </span>
                                            </td>
                                            <td>${new Date(result.endTime).toLocaleString('id-ID')}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-3 text-center">
                        <button class="btn" onclick="modal.classList.remove('active')">Tutup</button>
                    </div>
                </div>
            `;
            modal.classList.add('active');
        }

        // View result function
        function viewResult(resultId) {
            const result = dataManager.getExamResults().find(r => r.id === resultId);
            if (!result) {
                showToast('Hasil tidak ditemukan!', 'error');
                return;
            }
            
            const exam = dataManager.getExamById(result.examId);
            if (!exam) {
                showToast('Ujian tidak ditemukan!', 'error');
                return;
            }
            
            const questions = exam.questionIds.map(id => dataManager.getQuestionById(id));
            
            modalTitle.textContent = 'Detail Hasil Ujian';
            modalBody.innerHTML = `
                <div>
                    <h3>${exam.name}</h3>
                    <p><strong>Mata Pelajaran:</strong> ${exam.subject}</p>
                    <p><strong>Nilai:</strong> ${result.score}</p>
                    <p><strong>Status:</strong> 
                        <span class="badge ${result.score >= 70 ? 'badge-success' : 'badge-danger'}">
                            ${result.score >= 70 ? 'Lulus' : 'Tidak Lulus'}
                        </span>
                    </p>
                    <p><strong>Waktu Mulai:</strong> ${new Date(result.startTime).toLocaleString('id-ID')}</p>
                    <p><strong>Waktu Selesai:</strong> ${new Date(result.endTime).toLocaleString('id-ID')}</p>
                    
                    <h4 class="mt-3 mb-2">Jawaban</h4>
                    <div style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); padding: 0.5rem; border-radius: 5px;">
                        ${questions.map((question, index) => {
                            const userAnswer = result.answers[index];
                            const isCorrect = userAnswer === question.correctAnswer;
                            return `
                                <div class="mb-3">
                                    <p><strong>${index + 1}.</strong> ${question.question}</p>
                                    <div style="margin-left: 20px;">
                                        <p>A. ${question.options[0]} ${userAnswer === 0 ? (isCorrect ? '<span class="badge badge-success">Benar</span>' : '<span class="badge badge-danger">Salah</span>') : ''}</p>
                                        <p>B. ${question.options[1]} ${userAnswer === 1 ? (isCorrect ? '<span class="badge badge-success">Benar</span>' : '<span class="badge badge-danger">Salah</span>') : ''}</p>
                                        <p>C. ${question.options[2]} ${userAnswer === 2 ? (isCorrect ? '<span class="badge badge-success">Benar</span>' : '<span class="badge badge-danger">Salah</span>') : ''}</p>
                                        <p>D. ${question.options[3]} ${userAnswer === 3 ? (isCorrect ? '<span class="badge badge-success">Benar</span>' : '<span class="badge badge-danger">Salah</span>') : ''}</p>
                                        <p><small>Jawaban Benar: ${String.fromCharCode(65 + question.correctAnswer)}</small></p>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div class="mt-3 text-center">
                        <button class="btn" onclick="modal.classList.remove('active')">Tutup</button>
                    </div>
                </div>
            `;
            modal.classList.add('active');
        }

        // Search functionality
        document.getElementById('userSearch')?.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#userTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        document.getElementById('examSearch')?.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#examTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        document.getElementById('questionSearch')?.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#questionTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        document.getElementById('guruExamSearch')?.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#guruExamTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        document.getElementById('availableExamSearch')?.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#availableExamTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        document.getElementById('historySearch')?.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#historyTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
    </script>
</body>
</html>
